"use strict";function getIndex(e,t,o){for(var r=0;r<e.length;r++)if(e[r][t]==o)return r}function getUrlParam(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);return null!=o?unescape(o[2]):null}var app=angular.module("app",["appServices","appTemplates","ngAnimate","ngCookies","appFilters"]).controller("appController",["$scope",function(e){e.imgPath="/images",e.isPickerShow=!1}]);$(document).ready(function(){var e=$("#container");$("html").css("font-size",e.width()/375*parseInt($("html").css("font-size")))});var appFilters=angular.module("appFilters",[]);appFilters.filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),appFilters.filter("orderState",function(){return function(e){return 0==e?"未支付":1==e?"已支付":2==e?"配送中":3==e?"受理中":4==e?"已完成":5==e?"已失效":void 0}}),appFilters.filter("bankNo",function(){return function(e){return e.substr(-4)}});var appServices=angular.module("appServices",["ngResource"]);appServices.factory("accountSvc",["$q","$http",function(e,t){var o={};return o.getUserAccount=function(o){var r=e.defer();return t.jsonp(apiConfig.apiHost+"/share/findAccountInfo.html?mobile="+o+"&callback=JSON_CALLBACK").success(function(e){return r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},o.getBanks=function(o){var r=e.defer();return t.get("/mock-data/banks.json").success(function(e){return r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},o.recharge=function(o,r){var n=e.defer();return t.jsonp(apiConfig.apiHost+"/share/doAccountConsum.html?accountId=1&amount="+r+"&type=1&rechargeMobile="+o+"&callback=JSON_CALLBACK").success(function(e){return n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},o.refund=function(o,r){var n=e.defer();return t.jsonp(apiConfig.apiHost+"/share/doAccountConsum.html?accountId="+o+"&amount="+r+"&type=0&callback=JSON_CALLBACK").success(function(e){return n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},o.getUserAccountLog=function(o){var r=e.defer();return t.jsonp(apiConfig.apiHost+"/share/findAccountLogInfo.html?mobile="+o+"&callback=JSON_CALLBACK").success(function(e){return r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},o}]),appServices.factory("ActiveCodeSvc",["$resource","$q","$http",function(e,t,o){var r={};return r}]),appServices.factory("AddressSvc",["$http","$q",function(e,t){var o={};return o}]),appServices.factory("AuthenticationSvc",["$http","$q","$cookieStore",function(e,t,o){var r={};return r}]),appServices.factory("CouponSvc",["$http","$q",function(e,t){var o={};return o}]),appServices.factory("MessageSvc",["$http","$q",function(e,t){var o={};return o}]),appServices.factory("OrderSvc",["$http","$q",function(e,t){var o={};return o.getCounts=function(o){var r=t.defer();return e.get(apiConfig.apiHost+"/product/findOrderStatusCounts.html?receiverMobile="+o).success(function(e){return r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},o.getOrderList=function(o,r){var n=t.defer();return e.jsonp("http://m.yfq.cn/product/searchOrders.html?receiverMobile="+o+"&orderStatus="+r+"&callback=JSON_CALLBACK").success(function(e){return n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},o.getLogistics=function(o){var r=t.defer();return e.get(apiConfig.apiHost+"/product/findLogistics.html?orderNo="+o).success(function(e){return r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},o}]),appServices.factory("PaySvc",["$http","$q",function(e,t){var o={};return o}]),appServices.factory("ProductSvc",["$http","$q",function(e,t){var o={};return o.getProducts=function(){var o=t.defer();return e.get("/mock-data/products.json").success(function(e){return o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},o}]),appServices.factory("ShareSvc",["$q","$http",function(e,t){var o={};return o}]),appServices.factory("UserAgentSvc",["$http","$q",function(e,t){var o={},r=navigator.appVersion,n=navigator.userAgent,i=function(){return n.indexOf("iPhone")>-1||n.indexOf("iPod")>-1?"iPhone":"Android"},a=function(){var e=r.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)};return o.isWx=a(),o.platform_os=i(),o}]),appServices.factory("UserSvc",["$q","$http",function(e,t){var o={};return o.getMembers=function(){var o=e.defer();return t.get("/mock-data/members.json").success(function(e){return o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},o}]),appServices.factory("WxSvc",["$q","$http",function(e,t){var o={};return o}]),app.controller("aboutController",["$scope",function(e){}]),app.controller("accountController",["$scope","$cookieStore","$window","UserSvc",function(e,t,o,r){e.tab="income",e.setTab=function(t){e.tab=t},r.getMembers().then(function(t){console.log(t),e.members=t}),e.logout=function(){t.remove("appAuth"),o.location.href="/userController/login.html?openid="+e.$root.appAuth.weiXinData.openid}}]),app.controller("bookmarkController",["$scope",function(e){e.bookmarks=[]}]),app.controller("feedbackController",["$scope","MessageSvc",function(e,t){e.feedback="",e.postMessage=function(o,r){t.postMessage(o,r).then(function(t){t.success?(e.dialog.open(!0,"系统提示","反馈成功提交，请耐心等待回复",["我知道了",""]),e.feedback="",history.back()):e.dialog.open(!0,"系统提示",t.msg,["我知道了",""])})}}]),app.controller("helpController",["$scope",function(e){}]),app.controller("homeController",["$scope","ProductSvc",function(e,t){e.imgUrls=[];for(var o=1;o<=3;o++)e.imgUrls.push(e.imgPath+"/ad-"+o+".jpg");t.getProducts().then(function(t){console.log(t),e.products=t})}]),app.controller("loginController",["$scope","$location","$cookieStore","AuthenticationSvc",function(e,t,o,r){e.pageName="login",e.login=function(n,i){checkMobileCode(n,i)?r.binding(n).then(function(r){1===r.resultCode&&(e.$root.appAuth=r,e.$root.appAuth.isLogin=!0,o.put("appAuth",e.$root.appAuth),t.path("appBody"))}):e.dialog.open(!0,"系统提示","您的验证码不正确，请重新输入！",["我知道了",""])}}]),app.controller("logisticsController",["$scope","OrderSvc",function(e,t){var o=[{companyId:0,companyName:"邮政快递",phoneNo:"11183",logo:e.imgPath+"/logistics/0.png"},{companyId:1,companyName:"EMS快递",phoneNo:"11183",logo:e.imgPath+"/logistics/1.png"},{companyId:2,companyName:"顺丰快递",phoneNo:"11183",logo:e.imgPath+"/logistics/2.png"},{companyId:3,companyName:"圆通快递",phoneNo:"11183",logo:e.imgPath+"/logistics/3.png"},{companyId:4,companyName:"中通快递",phoneNo:"11183",logo:e.imgPath+"/logistics/4.png"}];null!=getUrlParam("orderNo")?e.orderNo=getUrlParam("orderNo"):e.orderNo="",t.getLogistics(e.orderNo).then(function(t){e.logistics=$.parseJSON(t),$.each(o,function(t,o){(o.companyName=e.logistics.comName)&&(e.logisticsCompany=o)})})}]),app.controller("memberController",["$scope","$cookieStore","$window","UserSvc",function(e,t,o,r){e.tab="income",e.setTab=function(t){e.tab=t},r.getMembers().then(function(t){console.log(t),e.members=t}),e.logout=function(){t.remove("appAuth"),o.location.href="/userController/login.html?openid="+e.$root.appAuth.weiXinData.openid}}]),app.controller("payStateController",["$scope","ShareSvc",function(e,t){e.addOverlay=function(){e.state.overlay.open(!0,$("#shareTips").html())},e.setShareState=function(o,r,n,i){t.getShareUrl(e.appAuth.receiverMobile,r,n,i,o.url).then(function(t){1===t.resultCode&&(o.url=t.shareUrl,e.state.share.open(!0,o))})}}]),app.controller("shareController",["$scope","UserSvc","ShareSvc",function(e,t,o){t.getUserAccount(e.appAuth.receiverMobile).then(function(t){e.userAccount=t}),o.getShareProduct(e.appAuth.receiverMobile).then(function(t){e.products=t}),e.recharge=function(e){t.recharge(e).then(function(e){console.log(e)})},e.withdrawal=function(e){t.withdrawal(e).then(function(e){console.log(e)})},e.showMoneyTips=function(){e.state.overlay.open(!0,$("#moneyTips").html())}}]),app.controller("choppingCartController",["$scope","OrderSvc",function(e,t){t.getOrderList("15013262507","").then(function(t){e.orderList=t})}]),app.directive("loadNext",[function(){return{restrict:"E",scope:{inputData:"=",outputData:"=",inputDataTag:"="},templateUrl:"loadMore/loadNext/loadNext.html",link:function(e,t,o){e.showWaitingIcon=!1,e.pageSize?e.pageSize=o.pageSize:e.pageSize=10,e.dataInit=function(){e.selPage=1,e.pages=Math.ceil(e.inputData.length/e.pageSize),e.outputData=e.inputData.slice(0,e.pageSize)},e.setData=function(){e.outputData=e.inputData.slice(e.pageSize*(e.selPage-1),e.selPage*e.pageSize)},e.selectPage=function(t){t<1||t>e.pages||(e.selPage=t,e.setData())},e.selectMore=function(t){t<1||t>e.pages||(e.selPage=t,e.outputData=e.inputData.slice(0,e.selPage*e.pageSize))},e.Previous=function(){e.selectPage(e.selPage-1)},e.Next=function(){e.selectPage(e.selPage+1)},e.More=function(){e.selectMore(1+e.selPage)},e.$watch("inputData",function(e,t,o){e!==t&&void 0!==e&&o.dataInit()},!0)}}}]),app.directive("productItem",[function(){return{restrict:"E",replace:!0,scope:{productItem:"=",totalAmount:"=",buyMobile:"="},templateUrl:"orderListItem/productItem/productItem.html",link:function(e,t,o){}}}]),app.controller("addBankController",["$scope","UserSvc",function(e,t){}]),app.controller("rechargeController",["$scope","UserSvc",function(e,t){e.recharge=function(o,r,n){o?t.recharge(r,n).then(function(t){e.dialog.open(!0,"系统提示",t.msg,["我知道了",""])}):e.dialog.open(!0,"系统提示","请输入充值金额",["我知道了",""])}}]),app.controller("billController",["$scope","UserSvc",function(e,t){e.tabs=[{name:"充值",count:"2",target:""},{name:"消费",count:"7",target:""},{name:"提现",count:"5",target:""},{name:"转账",count:"1",target:""}]}]),app.controller("refundController",["$scope","UserSvc","accountSvc",function(e,t,o){e.total=999,e.showBanks=function(){o.getBanks().then(function(t){e.banks=t}),e.isPickerShow=!0},e.withdrawal=function(t,o,r){t?e.dialog.open(!0,"系统提示","您的申请已提交成功",["我知道了",""]):e.dialog.open(!0,"系统提示","请输入提现金额",["我知道了",""])},e.setBank=function(t){e.bank=t,e.isPickerShow=!1}}]),app.controller("addressListController",["$scope","UserSvc",function(e,t){e.userAddresses=[];var o=[];t.getUserInfo(e.$root.appAuth.receiverMobile).then(function(t){t.result&&($.each(t.result,function(e,t){var r={name:t.memberName,mobile:t.recieverPhone,address:{id:t.id,province:"",city:t.city,district:"",room:t.city,receiverAddress:t.recieverAddress,isDefault:t.isDefault}};o.push(r)}),e.userAddresses=o)}),e.updateAddress=function(o,r,n){if(1===n){var i=[];$.each(e.userAddresses,function(e,t){if(o.address.id!==t.address.id){var r={name:t.name,mobile:t.mobile,address:{id:t.address.id,province:t.address.province,city:t.address.city,district:"",room:t.address.room,receiverAddress:t.address.receiverAddress,isDefault:t.address.isDefault}};i.push(r)}}),e.userAddresses=i}t.putUserInfo(o.name,o.mobile,o.address.id,o.address.province+o.address.city,o.address.room,r,n).then(function(t){t.success?e.$root.toast.open(!0):e.$root.dialog.open(!0,"系统提示",t.msg,["我知道了",""])})},e.back=function(){history.back()}}]),app.controller("newAddressController",["$scope","UserSvc",function(e,t){e.userInfo={name:"",mobile:"",address:{id:"",province:"",city:"",district:"",room:"",isDefault:!0}},e.checkAddress=function(){e.newAddressForm.receiverName.$valid?e.newAddressForm.receiverMobile.$valid?e.newAddressForm.receiverCity.$valid?e.newAddressForm.receiverRoom.$valid||e.$emit("notification",{show:!0,content:"请输入详细地址"}):e.$emit("notification",{show:!0,content:"请选择收件区域"}):e.$emit("notification",{show:!0,content:"请输入联系电话"}):e.$emit("notification",{show:!0,content:"请输入收件人"})},e.saveUser=function(o){return o?void t.putUserInfo(e.userInfo.name,e.userInfo.mobile,e.userInfo.address.id,e.userInfo.address.province+e.userInfo.address.city+e.userInfo.address.district,e.userInfo.address.room,e.userInfo.address.isDefault,0).then(function(t){t.success?history.back():e.$root.dialog.open(!0,"系统提示",t.msg,["我知道了",""])}):(e.checkAddress(),!1)}}]),app.controller("couponDetailController",["$scope","$stateParams","CouponSvc","UserAgentSvc",function(e,t,o,r){e.couponNo=t.couponNo,o.getCouponDetail(e.appAuth.receiverMobile,e.couponNo).then(function(t){e.coupon=t}),e.showShare=function(t,o){return 1==t?(e.state.notification.open(!0,"此优惠券已使用，无法分享"),!1):1==o?(e.state.notification.open(!0,"此优惠券已过期，无法分享"),!1):void 0},e.useCoupon=function(t,o,r){return 1==o?(t.preventDefault(),e.state.notification.open(!0,"此优惠券已使用，无法分享"),!1):1==r?(t.preventDefault(),e.state.notification.open(!0,"此优惠券已过期，无法分享"),!1):void 0}}]),app.controller("couponHomeController",["$scope","CouponSvc",function(e,t){t.getCouponList(e.$root.appAuth.receiverMobile).then(function(t){e.couponList=t})}]),app.controller("couponListController",["$scope","$stateParams","$location","$filter","CouponSvc",function(e,t,o,r,n){e.isUsed=t.isUsed,e.isOverdue=t.isOverdue,n.getCouponList(e.appAuth.receiverMobile).then(function(t){e.couponList=r("filter")(t.couponList,{isUsed:e.isUsed,isOverdue:e.isOverdue})})}]),app.controller("orderDetailController",["$scope","$cookieStore",function(e,t){}]),app.controller("orderListController",["$scope","OrderSvc","$location",function(e,t,o){t.getOrderList("15013262507","").then(function(t){e.orderList=t})}]),app.controller("shareListController",["$scope","ShareSvc",function(e,t){t.getShareProduct(e.appAuth.receiverMobile).then(function(t){e.products=t}),e.showShare=function(t,o){e.state.share.open(!0,o)}}]),app.controller("billDetailsController",["$scope","UserSvc",function(e,t){}]),app.controller("mktFlowController",["$scope","$cookieStore","MarketSvc",function(e,t,o){t.get("rechargeMobile")?e.mobile=t.get("rechargeMobile"):e.appAuth&&(e.mobile=e.appAuth.receiverMobile),e.buyProd=function(t){e.regionProduct=t,alert("还没下单接口"),e.state.overlay.open(!0,$("#paySuccess").html())},e.pay=function(e,t,r,n,i,a){console.log(e,t,r,n,i,a),o.pay(e,t,r,n,i,a,encodeURIComponent("http://mall.yfq.cn/payState/A/flow?returnUrl="+encodeURIComponent(window.location.href))).then(function(e){e.result?(console.log(e.payUrl),window.location.href=e.payUrl):console.log(e.msg)})},e.showOverlay=function(){e.state.overlay.open(!0,$("#flowTips").html())},e.$watch("mobile",function(e,r,n){e&&(t.put("rechargeMobile",e),o.getFlows(e).then(function(e){console.log(e),n.listData=e}))})}]),app.controller("mktFlowListController",["$scope","$stateParams","MarketSvc",function(e,t,o){e.mobile=t.mobile,e.selectedProd=function(t){e.product=t},e.buyProd=function(t){e.regionProduct=t,alert([e.product.productId,e.regionProduct.productFlowPriceId]),e.state.overlay.open(!0,$("#paySuccess").html())},e.showOverlay=function(){e.state.overlay.open(!0,$("#flowTips").html())},e.$watch("mobile",function(e,t,r){e&&o.getFlows(e).then(function(e){r.listData=e})})}]),app.directive("appActiveCode",["$interval","ActiveCodeSvc",function(e,t){return{restrict:"E",replace:!0,templateUrl:"activeCode/activeCode.html",link:function(o,r,n){o.activeText="获取验证码",o.activeClass=!0;var i=59,a=void 0;o.getActiveCode=function(r,n){return!$(r.currentTarget).hasClass("disabled")&&(o.loadingToast.open(!0),void t.getActiveCode(n).then(function(t){""==t&&(o.activeClass=!1,o.loadingToast.open(!1),a=e(function(){i<=0?(e.cancel(a),a=void 0,i=59,o.activeText="重发验证码",o.activeClass=!0):(o.activeText=i+"秒后可重发",o.activeClass=!1,i--)},1e3,100))}))}}}}]),app.directive("appFooterNav",["$timeout","$rootScope",function(e,t){return{restrict:"E",templateUrl:"appFooterNav/appFooterNav.html",link:function(e,t,o){}}}]),app.directive("appAddress",["$timeout","AddressSvc",function(e,t){return{restrict:"E",templateUrl:"address/adr.html",link:function(o,r,n){t.getProvince().then(function(e){o.$root.inputPickerData={tag:"address",data:e}}),o.setPickerShow=function(){o.$root.isPickerShow=!0},o.$watch("outputPickerData",function(e,o,r){if(e!==o&&void 0!=e){if("address"!==e.tag)return!1;"province"===e.data.name&&(r.userInfo.address.province=e.data.value,t.getCity(e.data.value).then(function(e){r.$root.inputPickerData={tag:"address",data:e}})),"city"===e.data.name&&(r.userInfo.address.city=e.data.value,t.getDistrict(r.userInfo.address.province,e.data.value).then(function(e){r.$root.inputPickerData={tag:"address",data:e}})),"district"===e.data.name&&(r.$root.isPickerShow=!1,r.userInfo.address.district=e.data.value,t.getProvince().then(function(e){r.$root.inputPickerData={tag:"address",data:e}}))}},!0),o.$watch("userInfo.address",function(t,o,r){e(function(){r.newAddressForm.receiverProvince.$valid&&r.newAddressForm.receiverCity.$valid&&r.newAddressForm.receiverDistrict.$valid&&(r.receiverAddress=r.userInfo.address.province+r.userInfo.address.city+r.userInfo.address.district)})},!0)}}}]),app.directive("contentScrollableScrolled",["$timeout",function(e){return{restrict:"A",link:function(e,t,o){$(t).bind("scroll",function(e){$(t).scrollTop()>=32?$("nav.nav").addClass("scrolled"):$("nav.nav").removeClass("scrolled")})}}}]),app.directive("appDialog",["$timeout",function(e){return{restrict:"E",templateUrl:"dialog/dialog.html",link:function(e,t,o){e.$root.dialog={show:!1,title:"",body:"",btnTxt:"",open:function(e,t,o,r){this.show=e,this.title=t,this.body=o,this.btnTxt=r},close:function(){this.show=!1}}}}}]),app.directive("appMenu",["$timeout","$rootScope",function(e,t){return{restrict:"E",templateUrl:"menu/menu.html",link:function(e,t,o){}}}]),app.directive("money",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,r){r.$parsers.push(function(e){var t=parseInt(e),n=parseInt(o.maxValue);return t<=n&&t>0?r.$setValidity("money",!0):r.$setValidity("money",!1),t})}}}]),app.directive("appNav",["$location",function(e){return{restrict:"E",replace:!0,templateUrl:"nav/nav.html",link:function(t,o,r){var n=$("#content-container");t.navItem=JSON.parse(r.navItem),t.$root.title=t.navItem.title,t.back=function(){t.navItem.backUrl?e.path(t.navItem.backUrl):history.back(),n.addClass("ng-back"),t.$emit("viewBack","ng-back")},t.getBill=function(e){t.$emit("navEvent",{navType:"bill",mobile:e})}}}}]),app.directive("orderListItem",["PaySvc",function(e){return{restrict:"E",replace:!0,scope:{orderListItem:"="},templateUrl:"orderListItem/orderListItem.html",link:function(t,o,r){t.dialog=function(e,o,r,n){t.$root.dialog.open(e,o,r,n)},t.setCertification=function(e){if(t.$root.appAuth.isWeiXin);else{e.preventDefault();var o='<img width="50%" src="/templates/fenxiao/pages/member/public/images/qrcode.jpg"><br><p>请长按上图二维码，进入公众号实名认证。</p>';t.$root.dialog.open(!0,"实名认证",o,["我知道了",""])}},t.buyNow=function(o,r,n){t.$root.loadingToast.open(!0),e.pay(o).then(function(e){"allow"==e?"jikaNew.html"==r||"jktchd"==r||"jktchdd"==r?window.location.href="/wap/payment/payView.html?orderNo="+n:window.location.href="/wap/taokafanghaoNew/checkData.html?orderId="+o:(t.$root.loadingToast.open(!1),t.$root.dialog.open(!0,"系统提示",e,["我知道了",""]))})}}}}]),app.directive("appOverlay",["$http","$compile","$timeout",function(e,t,o){return{restrict:"E",templateUrl:"overlay/overlay.html",replace:!0,link:function(e,t,o){$("#overlay-hook"),$("#container");e.removeOverlay=function(){e.state.overlay.open(!1)}}}}]),app.directive("owlCarousel",["$http","$compile",function(e,t){return{restrict:"C",templateUrl:"owlCarousel/owlCarousel.html",scope:{imgUrls:"="},link:function(e,t,o){}}}]).directive("carouselItem",["$http","$compile",function(e,t){return{restrict:"C",link:function(e,t,o){e.$last&&$(t).parent().owlCarousel({navigation:!0,slideSpeed:300,paginationSpeed:400,singleItem:!0,autoPlay:3e3})}}}]),app.directive("appPicker",[function(){return{restrict:"E",scope:{inputData:"=",outputData:"=",isShow:"="},templateUrl:"picker/picker.html",link:function(e,t,o){e.showWaitingIcon=!1,e.setPicker=function(t){e.outputData=t},e.setPickerHide=function(t){e.isPickerShow=!1}}}}]),app.directive("appShare",["ShareSvc",function(e){return{restrict:"E",templateUrl:"share/share.html",link:function(e,t,o){e.hideShare=function(){e.state.share.open(!1)}}}}]),app.directive("appTabs",["$timeout",function(e){return{restrict:"E",scope:{tabs:"="},templateUrl:"tabs/tabs.html",link:function(e,t,o){}}}]),app.directive("appToast",["$timeout",function(e){return{restrict:"E",templateUrl:"toast/toast.html",link:function(t,o,r){t.$root.toast={show:!1,open:function(o){this.show=o,e(function(){t.$root.toast.show=!1},2e3)},openUnLimit:function(e){this.show=e}},t.$root.loadingToast={show:!1,open:function(o){this.show=o,e(function(){t.$root.loadingToast.show=!1},2e3)},openUnLimit:function(e){this.show=e}}}}}]);